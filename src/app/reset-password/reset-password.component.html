<div class="login-container">
  <div class="row no-gutters h-100">
    
    <!-- Columna Izquierda - Imagen completa -->
    <div class="col-xl-8 col-lg-7 col-md-7 d-none d-md-flex background-column">
      <!-- La imagen de fondo se maneja en CSS -->
    </div>

    <!-- Columna Derecha - Formulario -->
    <div class="col-xl-4 col-lg-5 col-md-5 col-12 form-column">
      <div class="form-container">
        <div class="form-content">
          
          <!-- Header -->
          <div class="text-center header-section">
            <h2 class="welcome-title">Nueva Contraseña</h2>
            <p class="welcome-subtitle" *ngIf="!resetSuccess">
              Ingresa tu nueva contraseña
            </p>
          </div>

          <!-- Mensaje de éxito -->
          <div *ngIf="resetSuccess" class="success-message">
            <mat-icon class="success-icon">check_circle</mat-icon>
            <h3>Contraseña restablecida</h3>
            <p>Tu contraseña ha sido actualizada correctamente.</p>
            <p class="instructions">
              Serás redirigido al inicio de sesión en breve...
            </p>
          </div>

          <!-- Formulario -->
          <form *ngIf="!resetSuccess"
                class="reset-password-form" 
                [formGroup]="resetPasswordFormGroup" 
                (ngSubmit)="resetPassword()"
                novalidate>
            
            <!-- Campo Nueva Contraseña -->
            <div class="form-group">
              <mat-form-field appearance="outline" class="w-100" color="primary">
                <mat-label>Nueva Contraseña</mat-label>
                <input
                  matInput
                  placeholder="Ingresa tu nueva contraseña"
                  formControlName="newPassword"
                  required
                  [type]="hideNewPassword ? 'password' : 'text'"
                  autocomplete="new-password"
                  [disabled]="isLoading"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="hideNewPassword = !hideNewPassword"
                  [attr.aria-label]="'Ocultar contraseña'"
                  type="button"
                >
                  <mat-icon>{{ hideNewPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="resetPasswordFormGroup.controls['newPassword'].hasError('required')">
                  La contraseña es requerida.
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Requisitos de la contraseña -->
            <div class="password-requirements">
              <p class="requirements-title">La contraseña debe tener:</p>
              <div class="requirement-item" [class.valid]="hasValidLength">
                <mat-icon>{{ hasValidLength ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>Entre 10 y 16 caracteres</span>
              </div>
              <div class="requirement-item" [class.valid]="hasUpperCase">
                <mat-icon>{{ hasUpperCase ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>Al menos una letra mayúscula</span>
              </div>
              <div class="requirement-item" [class.valid]="hasNumber">
                <mat-icon>{{ hasNumber ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>Al menos un número</span>
              </div>
              <div class="requirement-item" [class.valid]="hasSpecialChar">
                <mat-icon>{{ hasSpecialChar ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>Al menos un carácter especial (. * - % /)</span>
              </div>
              <div class="requirement-item" [class.valid]="hasNoConsecutive">
                <mat-icon>{{ hasNoConsecutive ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>Sin letras iguales consecutivas</span>
              </div>
            </div>

            <!-- Campo Confirmar Contraseña -->
            <div class="form-group">
              <mat-form-field appearance="outline" class="w-100" color="primary">
                <mat-label>Confirmar Contraseña</mat-label>
                <input
                  matInput
                  placeholder="Confirma tu nueva contraseña"
                  formControlName="confirmPassword"
                  required
                  [type]="hideConfirmPassword ? 'password' : 'text'"
                  autocomplete="new-password"
                  [disabled]="isLoading"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="hideConfirmPassword = !hideConfirmPassword"
                  [attr.aria-label]="'Ocultar contraseña'"
                  type="button"
                >
                  <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="resetPasswordFormGroup.controls['confirmPassword'].hasError('required')">
                  Debes confirmar tu contraseña.
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Indicador de coincidencia -->
            <div class="password-match" *ngIf="resetPasswordFormGroup.get('confirmPassword')?.value">
              <div class="match-indicator" [class.valid]="passwordsMatch">
                <mat-icon>{{ passwordsMatch ? 'check_circle' : 'cancel' }}</mat-icon>
                <span>{{ passwordsMatch ? 'Las contraseñas coinciden' : 'Las contraseñas no coinciden' }}</span>
              </div>
            </div>
            
            <!-- Botón Restablecer -->
            <button 
              type="submit"
              class="reset-password-button" 
              [class.loading]="isLoading"
              mat-flat-button 
              color="primary" 
              [disabled]="!resetPasswordFormGroup.valid || isLoading">
              <span *ngIf="!isLoading">Restablecer contraseña</span>
              <span *ngIf="isLoading">Restableciendo...</span>
            </button>
          </form>

          <!-- Link de vuelta al login -->
          <div class="login-link">
            <a [routerLink]="['/login']" class="login-anchor">
              ← Volver al inicio de sesión
            </a>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

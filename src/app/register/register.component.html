<div class="register-container">
  <div class="row no-gutters h-100">

    <div class="col-xl-8 col-lg-7 col-md-7 d-none d-md-flex background-column">
      </div>

    <div class="col-xl-4 col-lg-5 col-md-5 col-12 form-column">
      <div class="form-container">
        <div class="form-content">

          <div class="text-center header-section">
            <h2 class="welcome-title">Crea tu cuenta</h2>
            </div>

          <form class="register-form"
                [formGroup]="registerFormGroup"
                #f="ngForm"
                (ngSubmit)="register()"
                novalidate>
            <div class="form-group">
              <mat-form-field appearance="outline" class="w-100" color="primary">
                <mat-label>Nombre</mat-label>
                <input
                  matInput
                  placeholder="Ingresa tu nombre"
                  formControlName="name"
                  required
                  type="text"
                  [disabled]="isLoading"
                />
                <mat-error *ngIf="registerFormGroup.controls['name'].hasError('required')">
                  El nombre es requerido.
                </mat-error>
                <mat-error *ngIf="registerFormGroup.controls['name'].hasError('maxlength')">
                  El nombre no puede exceder los 50 caracteres.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-group">
              <mat-form-field appearance="outline" class="w-100" color="primary">
                <mat-label>Email</mat-label>
                <input
                  matInput
                  placeholder="Ingresa tu email"
                  formControlName="email"
                  required
                  type="email"
                  autocomplete="email"
                  [disabled]="isLoading"
                />
                <mat-error *ngIf="registerFormGroup.controls['email'].hasError('required')">
                  El email es requerido.
                </mat-error>
                <mat-error *ngIf="registerFormGroup.controls['email'].hasError('email')">
                  Por favor, introduce un email válido.
                </mat-error>
                <mat-error *ngIf="registerFormGroup.controls['email'].hasError('maxlength')">
                  El email no puede exceder los 50 caracteres.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-group">
              <mat-form-field appearance="outline" class="w-100" color="primary">
                <mat-label>Contraseña</mat-label>
                <input
                  matInput
                  placeholder="Ingresa tu contraseña"
                  formControlName="password"
                  required
                  [type]="hidePassword ? 'password' : 'text'"
                  autocomplete="new-password"
                  (input)="onPasswordChange()"
                  [disabled]="isLoading"
                />
                <button
                  mat-icon-button
                  matSuffix
                  (click)="hidePassword = !hidePassword"
                  [attr.aria-label]="'Ocultar contraseña'"
                  [attr.aria-pressed]="hidePassword"
                  type="button"
                >
                  <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="registerFormGroup.controls['password'].hasError('required')">
                  La contraseña es requerida.
                </mat-error>
                <mat-error *ngIf="registerFormGroup.controls['password'].hasError('minlength')">
                  La contraseña debe tener al menos 10 caracteres.
                </mat-error>
                <mat-error *ngIf="registerFormGroup.controls['password'].hasError('maxlength')">
                  La contraseña no puede exceder los 16 caracteres.
                </mat-error>
                </mat-form-field>

              <div class="password-requirements">
                <div class="requirement-item" [ngClass]="{'valid': hasMinLength, 'invalid': !hasMinLength}">
                  <span class="requirement-icon">{{hasMinLength ? '✓' : '✗'}}</span>
                  10-16 caracteres
                </div>
                <div class="requirement-item" [ngClass]="{'valid': hasUppercase, 'invalid': !hasUppercase}">
                  <span class="requirement-icon">{{hasUppercase ? '✓' : '✗'}}</span>
                  Al menos una mayúscula
                </div>
                <div class="requirement-item" [ngClass]="{'valid': hasNumber, 'invalid': !hasNumber}">
                  <span class="requirement-icon">{{hasNumber ? '✓' : '✗'}}</span>
                  Al menos un número
                </div>
                <div class="requirement-item" [ngClass]="{'valid': hasSpecialChar, 'invalid': !hasSpecialChar}">
                  <span class="requirement-icon">{{hasSpecialChar ? '✓' : '✗'}}</span>
                  Al menos uno de estos caracteres: . * - % /
                </div>
                <div class="requirement-item" [ngClass]="{'valid': hasNoConsecutiveLetters, 'invalid': !hasNoConsecutiveLetters}">
                  <span class="requirement-icon">{{hasNoConsecutiveLetters ? '✓' : '✗'}}</span>
                  Sin letras iguales consecutivas
                </div>
              </div>
            </div>

            <mat-error *ngIf="typeError === 'conflicto'">Nombre de usuario o correo electrónico ya existe.</mat-error>

            <button
              type="submit"
              class="register-button"
              [class.loading]="isLoading"
              mat-flat-button
              color="primary"
              [disabled]="!registerFormGroup.valid || isLoading">
              <span *ngIf="!isLoading">Registrar</span>
              <span *ngIf="isLoading">Registrando...</span>
            </button>
          </form>

          <div class="login-link">
            <span>¿Ya tienes una cuenta?</span>
            <a [routerLink]="['/login']" class="login-anchor">
              Entra aquí
            </a>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>